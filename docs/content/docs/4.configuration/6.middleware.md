---
title: Route Protection Middleware
description: Configure automatic route protection and authentication redirects
---

The module provides route protection middleware that automatically redirects unauthenticated users and prevents access to protected content.

**By default, all routes are protected** -- except [configured auth routes](/docs/configuration#routes) which have special bidirectional behavior, and [legal document routes](/docs/configuration/legal-documents) which are always publicly accessible.

## Configuration

### Protect All Routes (Default)

By default, all routes (except auth and legal document routes) are protected. No configuration needed:

```typescript [nuxt.config.ts]
export default defineNuxtConfig({
  modules: ['@lightstack-dev/nuxt-final-auth']
  // All routes protected (except auth and legal document routes)
})
```

### Protect All Routes with Exceptions

```typescript [nuxt.config.ts]
export default defineNuxtConfig({
  auth: {
    middleware: {
      protectByDefault: true,    // Default - protect everything
      exceptionRoutes: ['/', '/about', '/docs/*']  // Keep these public
    }
  }
})
```

### Protect Specific Routes Only

```typescript [nuxt.config.ts]
export default defineNuxtConfig({
  auth: {
    middleware: {
      protectByDefault: false,    // Keep everything public by default
      exceptionRoutes: ['/dashboard', '/admin/*']  // Only protect these
    }
  }
})
```

### Disable Completely

```typescript [nuxt.config.ts]
export default defineNuxtConfig({
  auth: {
    middleware: false
  }
})
```

## Options

| Option            | Type       | Default | Description                                               |
| ----------------- | ---------- | ------- | --------------------------------------------------------- |
| `middleware`      | `{ protectByDefault?: boolean, exceptionRoutes?: string[] } \| false`{lang="ts-type"}  | `{ protectByDefault: true }`{lang="ts"} | Set to `false`{lang="ts"} to disable middleware completely |
| `middleware.protectByDefault` | `boolean`{lang="ts-type"}  | `true`{lang="ts"}  | `true`{lang="ts"}: Protect all except exceptions<br>`false`{lang="ts"}: Protect only exceptions |
| `middleware.exceptionRoutes` | `string[]`{lang="ts-type"} | `[]`{lang="ts"}    | Routes that are exceptions to the protectByDefault setting |

## Route Patterns

```typescript
exceptionRoutes: [
  '/dashboard',      // Exact path
  '/admin/*',        // Wildcard matching
  '/api/user/*'      // API routes
]
```

## Behavior

**Auth routes** have special bidirectional behavior:
- **Unauthenticated users** can access auth routes (sign-in, sign-up, reset)
- **Authenticated users** accessing auth routes → Redirected away

**Legal document routes** are always public:
- Routes configured in `auth.legal` (terms of service, privacy policy, etc.) are automatically excluded from protection
- No need to manually add them to `exceptionRoutes`
- Works in both `protectByDefault: true` and `protectByDefault: false` modes

**Protected routes**:
- **Unauthenticated users** accessing protected routes → Redirected to sign-in with return URL

Example authentication flow:
```
/dashboard → /auth/sign-in?redirect=%2Fdashboard → Logto auth → /dashboard
```

The auth pages integrate with Logto for the actual authentication, handling both social providers and credential-based sign-in.