---
title: Technical Specification
description: Implementation blueprint for the Lightstack nuxt-auth-ui module
---

Implementation blueprint for the Lightstack nuxt-auth-ui module.

## Architecture

### Dependencies

- **Peer Dependencies:**
  - `@logto/nuxt` (auth logic - installed separately by user)
  - `nuxt` (^4.0.0)

- **Direct Dependencies:**
  - `@nuxt/ui@next` (v4 alpha - UI components)
  - `zod` (form validation)

- **Optional:** `@nuxtjs/i18n` (localization)

### Module Structure

```
src/
├── module.ts                      # Module entry point
├── runtime/
│   ├── pages/                     # Dynamically injected routes
│   │   ├── sign-in.vue
│   │   ├── sign-up.vue
│   │   └── profile.vue
│   ├── components/
│   │   ├── AButton.vue            # Configurable prefix (default: 'A')
│   │   ├── AUserMenu.vue
│   │   ├── AProtected.vue
│   │   └── forms/
│   │       ├── SignInForm.vue
│   │       ├── SignUpForm.vue
│   │       └── ProfileForm.vue
│   ├── composables/
│   │   └── useAuthUI.ts           # Wrapper around useLogto()
│   └── middleware/
│       └── auth.ts                # Opt-in route protection
└── types/
    └── config.ts
```

**Phase 1 Scope (MVP):**

- Core pages only (sign-in, sign-up, profile)
- Essential components (AButton, AUserMenu, AProtected)
- Basic composable wrapping Logto
- No server routes initially (use Logto directly)

## Configuration API

```typescript
interface AuthUIConfig {
  // Routes
  prefix?: string; // default: '/auth'

  // Component naming
  componentPrefix?: string; // default: 'A' (results in AButton, AUserMenu, etc.)

  // Redirects
  redirects?: {
    afterSignIn?: string; // default: '/'
    afterSignOut?: string; // default: '/'
  };

  // Branding
  appName?: string;
  logo?: string;

  // Middleware
  middleware?: {
    global?: boolean; // default: false (opt-in by default)
    name?: string; // default: 'auth'
  };

  // Theme (auto-inherits from app.config.ts if using Nuxt UI)
  theme?: {
    primary?: string; // Nuxt UI color name
    gray?: string; // Nuxt UI gray scale
  };
}
```

**Usage:**

```typescript
// nuxt.config.ts
export default defineNuxtConfig({
  modules: [
    "@logto/nuxt", // User installs separately
    "@lightstack-dev/nuxt-auth-ui",
  ],
  authUi: {
    prefix: "/auth",
    componentPrefix: "A", // Use 'LA' if conflicts arise
    appName: "My App",
    middleware: {
      global: false, // Opt-in protection by default
    },
  },
});
```

## Pages Implementation

### `/auth/sign-in.vue`

- Email/password form with Zod validation
- Social provider buttons (auto-detected from Logto)
- "Don't have account?" link to sign-up
- Inline errors for form validation
- Toast on successful sign-in

### `/auth/sign-up.vue`

- Email/password/confirm form with Zod validation
- Social provider buttons (auto-detected)
- "Already have account?" link to sign-in
- Inline errors for form validation
- Toast on successful registration

### `/auth/profile.vue`

- Display: name, email, avatar
- Inline edit forms for each field
- Toast notifications for successful updates
- Inline errors for validation failures

**Future phases:**

- Password reset flow
- Security settings page
- Session management
- Account deletion

## Composables

### `useAuthUI()`

Main composable providing:

```typescript
{
  // Auth actions
  signIn: (email: string, password: string) => Promise<void>;
  signUp: (email: string, password: string) => Promise<void>;
  signOut: () => Promise<void>;

  // Profile management
  updateProfile: (data: ProfileData) => Promise<void>;
  changePassword: (current: string, next: string) => Promise<void>;

  // State
  user: ComputedRef<User | null>;
  loading: Ref<boolean>;
  error: Ref<string | null>;

  // Utilities
  redirectAfterAuth: (returnTo?: string) => Promise<void>;
}
```

## Server Routes

All under `/api/auth/` prefix, require authentication:

- `PATCH /api/auth/profile` - Update user profile
- `PATCH /api/auth/password` - Change password
- `GET /api/auth/sessions` - List active sessions
- `DELETE /api/auth/sessions/:id` - Revoke session
- `DELETE /api/auth/account` - Delete account

## Component API

### `<AButton />` (or configured prefix)

```vue
<!-- Shows "Sign in" when logged out, user menu when logged in -->
<AButton :variant="'solid'" :size="'md'" :redirect-to="'/dashboard'" />
```

### `<AUserMenu />`

```vue
<AUserMenu>
  <template #trigger>
    <CustomAvatar />
  </template>
</AUserMenu>
```

### `<AProtected />`

```vue
<AProtected :redirect="'/auth/sign-in'" :return-to="$route.fullPath">
  <ProtectedContent />
</AProtected>
```

**Middleware Usage:**

```vue
<script setup>
// Opt-in protection for specific pages
definePageMeta({
  middleware: "auth", // or custom name from config
});
</script>
```

## Error Handling

**UX Principles:**

- **Success + navigation**: Toast notifications
- **Errors + staying put**: Inline messages near the error source

**Form Validation:**

- Zod schemas for type-safe validation
- Real-time validation on blur
- Clear error messages below fields

**API Errors:**

- Auto-detected from Logto responses
- User-friendly messages (via i18n if available)
- Fallback to sensible defaults

## Theming

Leverages Nuxt UI's CSS variables:

- Uses `primary` and `gray` color scales
- Respects `--ui-radius` for border radius
- Follows `--ui-font-*` typography scale

Custom overrides via CSS variables:

```css
:root {
  --crew-border-radius: 8px;
  --crew-spacing: 1rem;
}
```

## Development Phases

### Phase 1: MVP (Current Focus)

- [ ] Module setup with @nuxt/ui@next
- [ ] Sign-in/sign-up pages
- [ ] Basic profile page
- [ ] Core components (AButton, AUserMenu, AProtected)
- [ ] useAuthUI composable
- [ ] Auth middleware (opt-in)
- [ ] Auto-detect social providers from Logto

### Phase 2: Enhanced Features

- [ ] Password reset flow
- [ ] Security settings page
- [ ] Session management UI
- [ ] Account deletion
- [ ] Loading states & skeletons
- [ ] Better error handling

### Phase 3: Advanced

- [ ] Passkeys (when Logto supports)
- [ ] MFA setup UI
- [ ] Social account linking
- [ ] i18n support

## Testing Requirements

- Unit tests for composables
- Component tests for forms
- E2E tests for complete flows
- Accessibility testing (WCAG AA)

## Bundle Size Target

< 20KB gzipped added to initial page load
