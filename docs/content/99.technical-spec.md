---
title: Technical Specification
description: Implementation blueprint for the Lightstack nuxt-auth-ui module
---

Implementation blueprint for the Lightstack nuxt-auth-ui module.

## Architecture

### Dependencies

- **Peer Dependencies:**
  - `@logto/nuxt` (auth logic - installed separately by user)
  - `nuxt` (^4.0.0)

- **Direct Dependencies:**
  - `@nuxt/ui@next` (v4 alpha - UI components)
  - `zod` (form validation)

- **Optional:** `@nuxtjs/i18n` (localization)

### Module Structure

```
src/
â”œâ”€â”€ module.ts                      # Module entry point
â”œâ”€â”€ runtime/
â”‚   â”œâ”€â”€ pages/                     # Dynamically injected routes
â”‚   â”‚   â”œâ”€â”€ sign-in.vue           # âœ… Implemented
â”‚   â”‚   â”œâ”€â”€ sign-up.vue           # ðŸš§ Planned
â”‚   â”‚   â””â”€â”€ profile.vue           # ðŸš§ Planned
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ SignInButton.vue      # âœ… Implemented (configurable prefix)
â”‚   â”‚   â”œâ”€â”€ SignUpButton.vue      # âœ… Implemented (configurable prefix)
â”‚   â”‚   â”œâ”€â”€ UserMenu.vue          # ðŸš§ Planned
â”‚   â”‚   â”œâ”€â”€ Protected.vue         # ðŸš§ Planned
â”‚   â”‚   â””â”€â”€ SignInForm.vue        # âœ… Implemented
â”‚   â”‚   â”‚   â”œâ”€â”€ SignUpForm.vue    # ðŸš§ Planned
â”‚   â”‚   â”‚   â””â”€â”€ ProfileForm.vue   # ðŸš§ Planned
â”‚   â”œâ”€â”€ composables/
â”‚   â”‚   â”œâ”€â”€ useAuthUI.ts           # âœ… Implemented - Wrapper around useLogto()
â”‚   â”‚   â””â”€â”€ useAuthUILocale.ts    # âœ… Implemented - i18n support
â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â””â”€â”€ auth.ts                # ðŸš§ Planned - Opt-in route protection
â”‚   â”œâ”€â”€ app.config.ts              # âœ… Implemented - Default UI configuration
â”‚   â””â”€â”€ plugin.ts                  # âœ… Implemented - Module plugin
â””â”€â”€ types/
    â”œâ”€â”€ config.ts                  # âœ… Implemented
    â””â”€â”€ app-config.d.ts            # âœ… Implemented - Type augmentation
```

**Phase 1 Scope (MVP):**

- âœ… Core sign-in page
- âœ… Essential components (SignInButton, SignUpButton)
- âœ… SignInForm component with full functionality
- âœ… Basic composable wrapping Logto
- âœ… i18n support with fallback to built-in messages
- âœ… Social provider auto-detection from Logto
- ðŸš§ Sign-up and profile pages
- No server routes initially (use Logto directly)

## Configuration API

```typescript
interface AuthUIConfig {
  // Routes - individually configurable for maximum control
  routes?: {
    signIn?: string; // default: '/auth/sign-in'
    signUp?: string; // default: '/auth/sign-up'
    signOut?: string; // default: '/auth/sign-out'
    profile?: string; // default: '/auth/profile'
    passwordReset?: string; // default: '/auth/password-reset'
  };

  // Social providers configuration
  socialProviders?: Array<{
    name: string;
    label?: string;
    icon?: string;
    enabled?: boolean;
  }>;

  // Component naming
  componentPrefix?: string; // default: 'A' (results in ASignInButton, ASignUpButton, etc.)

  // Redirects
  redirects?: {
    afterSignIn?: string; // default: '/'
    afterSignOut?: string; // default: '/'
  };

  // Branding
  appName?: string;
  logo?: string;

  // Middleware
  middleware?: {
    global?: boolean; // default: false (opt-in by default)
    name?: string; // default: 'auth'
  };

  // Messages - simple text overrides
  messages?: Record<string, string>;
}
```

**Usage:**

```typescript
// nuxt.config.ts
export default defineNuxtConfig({
  modules: [
    "@logto/nuxt", // User installs separately
    "@lightstack-dev/nuxt-auth-ui",
  ],
  authUi: {
    routes: {
      signIn: "/auth/sign-in",
      signUp: "/auth/sign-up",
    },
    componentPrefix: "A", // Use 'LA' if conflicts arise
    appName: "My App",
    middleware: {
      global: false, // Opt-in protection by default
    },
    messages: {
      signIn: "Log In",
      signUp: "Create Account",
    },
  },
});
```

## Pages Implementation

### `/auth/sign-in.vue` âœ… Implemented

- Email/password form with Zod validation
- Social provider buttons (auto-detected from Logto or configured)
- Configurable secondary actions via slots
- Inline errors for form validation
- Loading states during authentication
- Mock mode for documentation and testing
- Forgot password link support
- Remember me functionality

### `/auth/sign-up.vue`

- Email/password/confirm form with Zod validation
- Social provider buttons (auto-detected)
- "Already have account?" link to sign-in
- Inline errors for form validation
- Toast on successful registration

### `/auth/profile.vue`

- Display: name, email, avatar
- Inline edit forms for each field
- Toast notifications for successful updates
- Inline errors for validation failures

**Future phases:**

- Password reset flow
- Security settings page
- Session management
- Account deletion

## Composables

### `useAuthUI()`

Main composable providing:

```typescript
{
  // Auth actions
  signIn: (email: string, password: string) => Promise<void>;
  signUp: (email: string, password: string) => Promise<void>;
  signOut: () => Promise<void>;

  // Profile management
  updateProfile: (data: ProfileData) => Promise<void>;
  changePassword: (current: string, next: string) => Promise<void>;

  // State
  user: ComputedRef<User | null>;
  loading: Ref<boolean>;
  error: Ref<string | null>;

  // Utilities
  redirectAfterAuth: (returnTo?: string) => Promise<void>;
}
```

## Server Routes

All under `/api/auth/` prefix, require authentication:

- `PATCH /api/auth/profile` - Update user profile
- `PATCH /api/auth/password` - Change password
- `GET /api/auth/sessions` - List active sessions
- `DELETE /api/auth/sessions/:id` - Revoke session
- `DELETE /api/auth/account` - Delete account

## Component API

### `<ASignInButton />` (or configured prefix) âœ… Implemented

```vue
<!-- Shows "Sign in" when logged out, hidden when logged in -->
<ASignInButton />

<!-- Keep visible even when authenticated -->
<ASignInButton persistent />

<!-- Custom styling -->
<ASignInButton color="primary" size="xl" variant="solid">
  Get Started
</ASignInButton>
```

### `<ASignUpButton />` (or configured prefix) âœ… Implemented

```vue
<!-- Shows "Sign up" when logged out, hidden when logged in -->
<ASignUpButton />

<!-- Custom icon and label -->
<ASignUpButton leading-icon="i-lucide-user-plus-2" label="Create Account" />
```

### `<AUserMenu />` ðŸš§ Planned

```vue
<AUserMenu>
  <template #trigger>
    <CustomAvatar />
  </template>
</AUserMenu>
```

### `<AProtected />` ðŸš§ Planned

```vue
<AProtected :redirect="'/auth/sign-in'" :return-to="$route.fullPath">
  <ProtectedContent />
</AProtected>
```

**Middleware Usage:**

```vue
<script setup>
// Opt-in protection for specific pages
definePageMeta({
  middleware: "auth", // or custom name from config
});
</script>
```

## Error Handling

**UX Principles:**

- **Success + navigation**: Toast notifications
- **Errors + staying put**: Inline messages near the error source

**Form Validation:**

- Zod schemas for type-safe validation
- Real-time validation on blur
- Clear error messages below fields

**API Errors:**

- Auto-detected from Logto responses
- User-friendly messages (via i18n if available)
- Fallback to sensible defaults

## Theming

Leverages Nuxt UI's CSS variables:

- Uses `primary` and `gray` color scales
- Respects `--ui-radius` for border radius
- Follows `--ui-font-*` typography scale

Custom overrides via CSS variables:

```css
:root {
  --crew-border-radius: 8px;
  --crew-spacing: 1rem;
}
```

## Development Phases

### Phase 1: MVP (Current Focus)

- [x] Module setup with @nuxt/ui@next
- [x] Sign-in page
- [x] Core components (SignInButton, SignUpButton)
- [x] SignInForm component with full API
- [x] useAuthUI composable
- [x] useAuthUILocale composable with i18n support
- [x] App config type augmentation
- [x] Lucide icons integration
- [x] Auto-detect social providers from Logto
- [x] Flexible slot-based secondary actions
- [x] Password reset URL configuration
- [ ] Sign-up page
- [ ] Basic profile page
- [ ] UserMenu component
- [ ] Protected component
- [ ] Auth middleware (opt-in)

### Phase 2: Enhanced Features

- [ ] Password reset flow
- [ ] Security settings page
- [ ] Session management UI
- [ ] Account deletion
- [ ] Loading states & skeletons
- [ ] Better error handling

### Phase 3: Advanced

- [ ] Passkeys (when Logto supports)
- [ ] MFA setup UI
- [ ] Social account linking
- [ ] i18n support

## Testing Requirements

- Unit tests for composables
- Component tests for forms
- E2E tests for complete flows
- Accessibility testing (WCAG AA)

## Bundle Size Target

< 20KB gzipped added to initial page load
